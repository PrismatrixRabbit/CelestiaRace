<?xml version="1.0" encoding="utf-8"?>
<Defs>
    
    <RecipeDef Name="Celes_Surgery" Abstract="True">
        <recipeUsers>
            <li>Celes_Race</li>
        </recipeUsers>
        <effectWorking>Surgery</effectWorking>
        <soundWorking>Recipe_Surgery</soundWorking>
        <workSpeedStat>MedicalOperationSpeed</workSpeedStat>
        <workSkill>Medicine</workSkill>
        <workSkillLearnFactor>16</workSkillLearnFactor>
        <surgeryOutcomeEffect>SurgeryOutcomeBase</surgeryOutcomeEffect>
        <anesthetize>false</anesthetize>
    </RecipeDef>

    <!-- ========== 标准节律 ========== -->

    <RecipeDef ParentName="Celes_Surgery">
        <defName>Celes_ActiveDustMechRhythm_Standard</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_Activity</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Standard</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Standard</li>
                </AllowWhenHediff>
                <DisallowWhenHediff>  
                    <li>Celes_DustMechRhythm_Activity</li>
                    <li>Celes_DustMechRhythm_ProtocolIII</li>
                    <li>Celes_DustMechRhythm_Dormant</li>
                </DisallowWhenHediff>
                <useRace>true</useRace>
                <race>
                    <li>Celes_Race</li>
                </race>
            </li>
        </modExtensions>
        <label>Celes_ActiveDustMechRhythm_Standard</label>
        <description>Celes_ActiveDustMechRhythm_Standard</description>
        <jobString>Celes_ActiveDustMechRhythm_Standard</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Activity</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Overactivity</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <thingDefs>
                        <li>CelesNanoMachine</li>
                    </thingDefs>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <thingDefs>
                <li>CelesNanoMachine</li>
            </thingDefs>
        </fixedIngredientFilter>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

    <RecipeDef ParentName="Celes_Surgery">
        <defName>Celes_RemoveDustMechRhythm_ActivityForCeles</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_Dormant</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Activity</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Activity</li>
                </AllowWhenHediff>
                <useRace>true</useRace>
                <race>
                    <li>Celes_Race</li>
                </race>
            </li>
        </modExtensions>
        <label>Celes_RemoveDustMechRhythm_ActivityForHuman</label>
        <description>Celes_RemoveDustMechRhythm_ActivityForHuman</description>
        <jobString>Celes_RemoveDustMechRhythm_ActivityForHuman</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Activity</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Dormant</HediffDef>
        </descriptionHyperlinks>
        <workerClass>Recipe_RemoveHediff</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>Medicine</li>
                    </categories>
                </filter>
                <count>4</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>Medicine</li>
            </categories>
            <disallowedThingDefs>
                <li>MedicineHerbal</li>
            </disallowedThingDefs>
        </fixedIngredientFilter>
        <products>
            <CelesNanoMachine>10</CelesNanoMachine>
            <Neutroamine>10</Neutroamine>
        </products>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

    <!-- ========== 军用节律 ========== -->

    <RecipeDef ParentName="Celes_Surgery">
        <defName>Celes_MilitarizeDustMechRhythm_Standard</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_Military</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Standard</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Standard</li>
                </AllowWhenHediff>
                <DisallowWhenHediff>
                    <li>Celes_DustMechRhythm_Military</li>
                </DisallowWhenHediff>
                <useRace>true</useRace>
                <race>
                    <li>Celes_Race</li>
                </race>
            </li>
        </modExtensions>
        <label>Celes_MilitarizeDustMechRhythm_Standard</label>
        <description>Celes_MilitarizeDustMechRhythm_Standard</description>
        <jobString>Celes_MilitarizeDustMechRhythm_Standard</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Military</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <thingDefs>
                        <li>CelesNanoMachine</li>
                    </thingDefs>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <thingDefs>
                <li>CelesNanoMachine</li>
            </thingDefs>
        </fixedIngredientFilter>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

    <RecipeDef ParentName="Celes_Surgery">
        <defName>Celes_DemilitarizeDustMechRhythm_Standard</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_Standard</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Military</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Military</li>
                </AllowWhenHediff>
                <DisallowWhenHediff>
                    <li>Celes_DustMechRhythm_Standard</li>
                </DisallowWhenHediff>
                <useRace>true</useRace>
                <race>
                    <li>Celes_Race</li>
                </race>
            </li>
        </modExtensions>
        <label>Celes_DemilitarizeDustMechRhythm_Standard</label>
        <description>Celes_DemilitarizeDustMechRhythm_Standard</description>
        <jobString>Celes_DemilitarizeDustMechRhythm_Standard</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Military</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <thingDefs>
                        <li>CelesNanoMachine</li>
                    </thingDefs>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <thingDefs>
                <li>CelesNanoMachine</li>
            </thingDefs>
        </fixedIngredientFilter>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

    <!-- ========== 人类节律 ========== -->

    <RecipeDef ParentName="SurgeryFlesh">
        <defName>Celes_ImplantDustMechRhythm</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_Activity</hediffToAdd>
                <removeHediff>false</removeHediff>
                <DisallowWhenHediff>
                    <li>Celes_DustMechRhythm_Standard</li>
                    <li>Celes_DustMechRhythm_ProtocolIII</li>
                    <li>Celes_DustMechRhythm_Activity</li>
                    <li>Celes_DustMechRhythm_Dormant</li>
                    <li>Celes_DustMechRhythm_Military</li>
                    <li>Celes_DustMechRhythm_ProtocolII</li>
                    <li>Celes_DustMechRhythm_Overactivity</li>
                    <li>Celes_DustMechRhythm_Extreme</li>
                    <li>Celes_DustMechRhythm_DormantHuman</li>
                    <li>Celes_DustMechRhythm_Serve</li>
                </DisallowWhenHediff>
            </li>
        </modExtensions>
        <label>Celes_ImplantDustMechRhythm</label>
        <description>Celes_ImplantDustMechRhythm</description>
        <jobString>Celes_ImplantDustMechRhythm</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Activity</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <thingDefs>
                        <li>CelesNanoMachine</li>
                    </thingDefs>
                </filter>
                <count>1</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <thingDefs>
                <li>CelesNanoMachine</li>
            </thingDefs>
        </fixedIngredientFilter>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

    <RecipeDef ParentName="SurgeryFlesh">
        <defName>Celes_RemoveDustMechRhythm_ActivityForHuman</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_DormantHuman</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Activity</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Activity</li>
                </AllowWhenHediff>
            </li>
        </modExtensions>
        <label>Celes_RemoveDustMechRhythm_ActivityForHuman</label>
        <description>Celes_RemoveDustMechRhythm_ActivityForHuman</description>
        <jobString>Celes_RemoveDustMechRhythm_ActivityForHuman</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Activity</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Overactivity</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>Medicine</li>
                    </categories>
                </filter>
                <count>4</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>Medicine</li>
            </categories>
            <disallowedThingDefs>
                <li>MedicineHerbal</li>
            </disallowedThingDefs>
        </fixedIngredientFilter>
        <products>
            <CelesNanoMachine>10</CelesNanoMachine>
            <Neutroamine>10</Neutroamine>
        </products>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

    <RecipeDef ParentName="SurgeryFlesh">
        <defName>Celes_RemoveCeles_DustMechRhythm_Overactivity</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_DormantHuman</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Overactivity</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Overactivity</li>
                </AllowWhenHediff>
            </li>
        </modExtensions>
        <label>remove celestia nanomachine infection from infected person</label>
        <description>.</description>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Activity</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Serve</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <jobString>Removing nanomachine infection.</jobString>
        <workAmount>1500</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <skillRequirements>
            <Medicine>4</Medicine>
        </skillRequirements>
        <surgerySuccessChanceFactor>0.7</surgerySuccessChanceFactor>
        <deathOnFailedSurgeryChance>0.25</deathOnFailedSurgeryChance>
        <isViolation>false</isViolation>
        <anesthetize>true</anesthetize>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>Medicine</li>
                    </categories>
                </filter>
                <count>4</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>Medicine</li>
            </categories>
            <disallowedThingDefs>
                <li>MedicineHerbal</li>
            </disallowedThingDefs>
        </fixedIngredientFilter>
        <products>
            <CelesNanoMachine>10</CelesNanoMachine>
            <Neutroamine>10</Neutroamine>
        </products>
        <researchPrerequisite>
            <li>Celes_NanoImplant_I</li>
        </researchPrerequisite>
    </RecipeDef>

    <RecipeDef ParentName="SurgeryFlesh">
        <defName>Celes_SetDustMechRhythm_Serve</defName>
        <modExtensions>
            <li Class="CelesFeature.Celes_RecipeModExtension">
                <addHediff>true</addHediff>
                <hediffToAdd>Celes_DustMechRhythm_Serve</hediffToAdd>
                <removeHediff>true</removeHediff>
                <hediffToRemove>Celes_DustMechRhythm_Extreme</hediffToRemove>
                <AllowWhenHediff>
                    <li>Celes_DustMechRhythm_Extreme</li>
                </AllowWhenHediff>
                <DisallowWhenHediff>
                    <li>Celes_DustMechRhythm_Serve</li>
                </DisallowWhenHediff>
            </li>
        </modExtensions>
        <label>Celes_SetDustMechRhythm_Serve</label>
        <description>Celes_SetDustMechRhythm_Serve</description>
        <jobString>Celes_SetDustMechRhythm_Serve</jobString>
        <descriptionHyperlinks>
            <HediffDef>Celes_DustMechRhythm_Standard</HediffDef>
            <HediffDef>Celes_DustMechRhythm_Military</HediffDef>
        </descriptionHyperlinks>
        <workerClass>CelesFeature.Celes_RecipeSurgery</workerClass>
        <workAmount>2000</workAmount>
        <hideBodyPartNames>true</hideBodyPartNames>
        <targetsBodyPart>false</targetsBodyPart>
        <isViolation>false</isViolation>
        <deathOnFailedSurgeryChance>0</deathOnFailedSurgeryChance>
        <surgerySuccessChanceFactor>5.0</surgerySuccessChanceFactor>
        <skillRequirements>
            <Medicine>6</Medicine>
            <Intellectual>4</Intellectual>
        </skillRequirements>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>Medicine</li>
                    </categories>
                </filter>
                <count>4</count>
            </li>
        </ingredients>
        <fixedIngredientFilter>
            <categories>
                <li>Medicine</li>
            </categories>
            <disallowedThingDefs>
                <li>MedicineHerbal</li>
            </disallowedThingDefs>
        </fixedIngredientFilter>
        <products>
            <CelesNanoMachine>10</CelesNanoMachine>
            <Neutroamine>10</Neutroamine>
        </products>
        <researchPrerequisite>
            <li>Celes_NanoImplant_II</li>
        </researchPrerequisite>
        <uiIconThing>CelesNanoMachine</uiIconThing>
    </RecipeDef>

</Defs>